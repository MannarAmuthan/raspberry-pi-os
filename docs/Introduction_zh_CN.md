## Raspberry Pi OS项目介绍/如何有效地学习操作系统开发？

几年前，我第一次打开了Linux内核的源代码。
那时，我认为自己或多或少是一个熟练的软件开发人员：
我对汇编程序和C编程有一点了解，
并且对主要操作系统概念有了高层次的理解，
例如进程调度和虚拟内存管理。
然而，我的第一次尝试是完全失败的
- 我几乎什么都不懂。

对于我必须处理的其他软件项目，
我有一个通常很有效的简单方法：
我找到程序的入口点，
然后开始阅读源代码，
尽可能深入了解我所感兴趣的所有细节。
这种方法效果良好，
但不适用于像操作系统那样复杂的东西。
这不仅仅是因为我花了一个多星期的时间才找到一个切入点 
- 主要的问题是我很快发现自己处于一种我正在查看几行代码的情况，
我不知道如何找到关于这些线路做什么的任何线索。
对于低级汇编程序源代码尤其如此，
但对于我尝试调查的系统的任何其他部分，
它都没有效果。

我不喜欢只是因为从一开始就看起来很复杂而解决问题的想法。
此外，我认为没有复杂的问题。
相反，有很多问题我们根本不知道如何有效地解决，
所以我开始寻找一种有效的方法来学习OS开发，特别是Linux。


### 学习操作系统开发的挑战

我知道有大量关于Linux内核开发的书籍和文档，但它们都没有为我提供我想要的学习经验。一半的材料是如此肤浅，我已经知道了。在另一半中，我遇到了一个与探索内核源代码非常相似的问题：只要一本书足够深入，90％的细节似乎与核心概念无关，但与某些安全性，性能有关或遗留的考虑因素以及Linux内核支持的数百万个功能。因此，您不必学习核心操作系统概念，而是始终深入研究这些功能的实现细节。

您可能想知道为什么我需要首先学习操作系统开发。对我而言，主要原因是我总是对引擎的运作方式感兴趣。这不仅仅是好奇心：您正在处理的任务越困难，通常情况就会开始追溯到操作系统级别。如果您不了解一切如何在较低级别工作，您就无法做出完全明智的技术决策。另一件事是，如果您真的喜欢技术挑战，那么使用OS开发对您来说是一项令人兴奋的任务。

您可能会问的下一个问题是，为什么选择Linux？其他操作系统可能更容易接近。答案是，我希望我的知识至少在某种程度上与我目前正在做的事情以及我希望将来会做的事情相关。 Linux在这方面是完美的，因为现在从小型物联网设备到大型服务器的所有东西都倾向于运行Linux。

当我说大多数关于Linux内核开发的书籍对我来说效果不好时 - 我并不是很诚实。有一本书使用我能够完全理解的实际源代码解释了一些基本概念，即使我是OS开发的新手。本书是“Linux设备驱动程序”，毫无疑问它是关于Linux内核的最着名的技术书籍之一。首先介绍一个可以编译和使用的简单驱动程序的源代码。然后它开始逐一介绍新的驱动程序相关概念，并解释如何修改驱动程序的源代码以使用这些新概念。这正是我所说的“良好的学习体验”。本书唯一的问题是它明确关注驱动程序开发，并且对核心内核实现细节的描述很少。

但为什么没有人为内核开发人员创建类似的书？我想这是因为如果你使用当前的Linux内核源代码作为你的书的基础，那么这是不可能的。没有任何功能，结构或模块可以用作简单的起点，因为Linux源代码并不简单。您也不能一次引入一个新概念，因为在源代码中，一切都彼此密切相关。在我意识到这一点后，我想到了一个想法：如果Linux内核太庞大而且太复杂而不能用作学习OS开发的起点，为什么我不实现我自己的操作系统，它将明确地用于学习目的？通过这种方式，我可以使操作系统足够简单，以提供良好的学习体验。此外，如果这个操作系统主要通过复制和简化Linux内核源代码的不同部分来实现，那么将它作为学习Linux内核的起点也很简单。除了操作系统之外，我还决定编写一系列讲授主要操作系统开发概念的讲座，并完整地解释操作系统源代码。

### OS要求

我开始研究该项目，后来成为[RPi OS]（https://github.com/s-matyukevich/raspberry-pi-os）。我要做的第一件事就是确定我认为是“基本”的内核开发的哪些部分，以及我认为哪些组件不那么重要且可以跳过（至少在开始时）。据我了解，每个操作系统都有两个基本目标：

1.单独运行用户进程。
1.为每个用户进程提供机器硬件的统一视图。

为了满足第一个要求，RPi OS需要有自己的调度程序。如果我想实现一个调度程序，我还必须处理定时器中断。第二个要求意味着操作系统应该支持一些驱动程序并提供系统调用以将它们暴露给用户应用程序。由于这是初学者，我不想使用复杂的硬件，因此我唯一关心的驱动程序是能够在屏幕上写入内容并从键盘读取用户输入的驱动程序。此外，操作系统需要能够加载和执行用户程序，因此自然需要支持某种文件系统并能够理解某种可执行文件格式。如果操作系统可以支持基本网络，那将是很好的，但我不想专注于初学者的文本。所以这些基本上是我可以确定为“任何操作系统的核心概念”的东西。

现在让我们来看看我想忽略的事情：
1. **性能**我不想在操作系统中使用任何复杂的算法。为简单起见，我还将禁用所有缓存和其他性能优化技术。
1. **安全性** RPi OS确实至少具有一个安全功能：虚拟内存。其他一切都可以安全地被忽略。
1. **多处理和同步**我很高兴我的操作系统在单处理器核心上执行。特别是，这使我摆脱了巨大的复杂性 - 同步。
1. **支持多种架构和不同类型的设备**下一节将详细介绍。
1. **任何生产就绪操作系统支持的数百万其他功能**

### Raspberry Pi如何发挥作用

我已经提到过，我不希望RPi OS支持多种计算机体系结构或许多不同的设备。在我深入研究Linux内核驱动程序模型后，我对此感到更加强烈。看起来即使具有类似目的的设备在实现细节上也可能有很大差异。这使得很难围绕不同的驱动程序类型提出简单的抽象，并重用驱动程序源代码。对我来说，这似乎是Linux内核中复杂性的主要来源之一，我绝对想在RPi OS中避免它。好的，但是我应该使用什么样的电脑呢？我显然不想使用我的笔记本电脑测试我的裸机程序，因为我真的不确定它是否会存活下来。更重要的是，我不希望人们购买昂贵的笔记本电脑只是为了遵循我的操作系统开发练习（我认为没有人会这样做）。仿真器看起来或多或少是一个不错的选择，但我想使用真正的设备，因为它让我感觉我正在做一些真实而不是玩裸机编程。

我最终使用了Raspberry Pi，特别是[Raspberry Pi 3 Model B]（https://www.raspberrypi.org/products/raspberry-pi-3-model-b/）。由于多种原因，使用此设备看起来是理想的选择：

它的价格大约在35美元左右。我认为这应该是一个实惠的价格。
1.该设备专为学习而设计。它的内部架构尽可能简单，完全符合我的需求。
1.该设备使用ARM v8架构。这是一个简单的RISC架构，非常适合OS作者的需求，并且没有如流行的x86架构那么多的遗留要求。如果您不相信我，可以比较Linux内核中`/ arch / arm64`和`/ arch / x86`文件夹中的源代码量。

操作系统与旧版本的Raspberry Pi不兼容，因为它们都不支持64位ARM v8架构，但我认为对所有未来设备的支持应该是微不足道的。

### 与社区合作

任何技术书籍的一个主要缺点是，在发布后不久，每本书都会过时。 如今技术发展如此之快，以至于书籍作者几乎不可能跟上它。 这就是为什么我喜欢“开源书籍”的想法 - 这本书可以在互联网上免费获取，并鼓励其读者参与内容创作和验证。 如果书籍内容在Github上可用，任何读者都可以轻松修复和开发新的代码示例，更新书籍内容，并参与撰写新的章节。 我知道现在项目并不完美，在撰写本文时甚至还没有完成。 但我现在仍想发布它，因为我希望在社区的帮助下，我不仅能够更快地完成项目，而且能够使它比起初更好，更有用。

#### 上一页
[Main Page](https://github.com/s-matyukevich/raspberry-pi-os#learning-operating-system-development-using-linux-kernel-and-raspberry-pi)

##### 下一页

[Contributing to the Raspberry PI OS](../docs/Contributions_zh_CN.md)
